## Smoke Test Backend IA

- **Base URL**: `https://api-ia.bodasdehoy.com`
- **Development**: `bodasdehoy`
- **Providers**: `auto`
- **Model (default)**: ``
- **RequestId**: `smoke_20260121_071541_20431`
- **Fecha (UTC)**: `2026-01-21T06:15:41Z`

### 1) Health
```
HTTP/2 200 
date: Wed, 21 Jan 2026 06:15:41 GMT
content-type: application/json
content-length: 124
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=OkR8jFjHjFAOrTAz5Vmi%2BaAMcK3HENgtSmpbAhUa1VsaIUQ5ZTIfakQ%2FoAcpYuYF7YD1u2Y4X4Lrx0pvUmjjEErKZpMl%2Bs5tcGzypfbjbd4qZvk%3D"}]}
cf-ray: 9c14adb2ff5eec99-MAD
alt-svc: h3=":443"; ma=86400

{"status":"healthy","timestamp":"2026-01-21T06:15:41.640347","services":{"websockets":"0 active","graphql_proxy":"running"}}```

### 2) Models (auto)
```
HTTP/2 200 
date: Wed, 21 Jan 2026 06:15:42 GMT
content-type: application/json
content-length: 213
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=trZ3KvXvJPCblwTW1JaQLvSnAkfYuB7lUPlmZUCpFuVuESquBFYU8XecHtxad7wXLLZYhpX%2FPsaB%2BBuofOpl3qcJvgVfhrxyrNrJe0pVPGh7hQ39Aw%3D%3D"}]}
cf-ray: 9c14adb66e650345-MAD
alt-svc: h3=":443"; ma=86400

[{"id":"auto","name":"Auto - Selección automática","provider":"auto","context":128000,"maxOutput":4096,"description":"El sistema selecciona automáticamente el mejor provider según disponibilidad y criterios"}]```

### 3) Chat (auto) stream:false (esperado: JSON)
```
HTTP/2 503 
date: Wed, 21 Jan 2026 06:15:42 GMT
content-type: application/json
content-length: 624
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=2HNgGgAUYALeqHNARYmVX58yUnharBZgq%2FwJ3sTgppcNPeUwJ38SCsMi1IG5LkMP6jhjO9Qaq8Wx%2BGzZK45%2B74oAE9zTNKZpTRzy%2FJBtrSKjTpYyIg%3D%3D"}]}
cf-ray: 9c14adb80b8bcbbe-MAD
alt-svc: h3=":443"; ma=86400

{"success":false,"error":"No se pudo generar una respuesta. El orchestrator devolvió una respuesta vacía o genérica.","error_code":"EMPTY_RESPONSE","trace_id":"561865cb","provider":"ollama","model":"qwen2.5:7b","upstream_status":null,"timestamp":"2026-01-21T06:15:42.416366","suggestion":"Por favor, intenta de nuevo o verifica la configuración de providers.","metadata":{"error":"empty_response","original_result":"{'message': 'Lo siento, hubo un error al procesar tu mensaje. Por favor, inténtalo de nuevo.', 'error': 'Ollama no disponible', 'tokens_used': 0, 'cost': 0, 'provider': 'ollama', 'model': 'qwen2.5:7b'"}}```

**Resultado:** ❌ FAIL — 503 EMPTY_RESPONSE pero la causa parece ser "Ollama no disponible" (debería ser PROVIDER_UNAVAILABLE y/o no seleccionar Ollama si no está disponible).

**Sugerencia (backend):** devolver error_code=PROVIDER_UNAVAILABLE (o similar) y upstream_status explícito; y evitar fallback/selección a Ollama cuando no está disponible.

### 4) Chat (auto) stream:true (esperado: SSE sin event:error, o 503 JSON estructurado)
```
HTTP/2 503 
date: Wed, 21 Jan 2026 06:15:43 GMT
content-type: application/json
content-length: 508
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=FCsE7JQ4ul3m5ODhGUJ7DZmJlPHPgX58dlM33HKTakpXzyUITUOfnzXrVWwfHY5e8RvjIWpxw8HD3OfFNKeuk9BHf9JI4dwiT%2BTabyxccrmcaPkhJw%3D%3D"}]}
cf-ray: 9c14adbc0d56013d-MAD
alt-svc: h3=":443"; ma=86400

{"detail":{"error":"No hay proveedores disponibles. Por favor, configura al menos una API key (OpenAI, Anthropic, OpenRouter, etc.) o asegúrate de que Ollama esté corriendo.","error_code":"NO_PROVIDERS_AVAILABLE","trace_id":"c0da401e","provider":"auto","model":null,"upstream_status":null,"timestamp":"2026-01-21T06:15:43.313301","context":{"suggestion":"Por favor, configura al menos una API key (OPENAI_API_KEY, ANTHROPIC_API_KEY, OPENROUTER_API_KEY, etc.) o asegúrate de que Ollama esté corriendo."}}}```

**Resultado:** ✅ OK (503 esperado: NO_PROVIDERS_AVAILABLE).

### 6) Provider forzado (debe respetarse o devolver AUTH_ERROR/PROVIDER_ERROR; NO caer a Ollama)

#### 6.1) Chat (google) stream:false
```
HTTP/2 503 
date: Wed, 21 Jan 2026 06:15:43 GMT
content-type: application/json
content-length: 624
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=KcR70PQVomceCn4C4%2BusBmFwMoypJZv7pNLyFCts5b9w2MMGJjVMoYpdTGXGGZ4I9UMSN4zNzyoxhaGk3SnjxLh%2FY7q6%2FxyB%2BSBB3ELiGkpOFjsoAw%3D%3D"}]}
cf-ray: 9c14adc12955ceb3-MAD
alt-svc: h3=":443"; ma=86400

{"success":false,"error":"No se pudo generar una respuesta. El orchestrator devolvió una respuesta vacía o genérica.","error_code":"EMPTY_RESPONSE","trace_id":"d546f2f2","provider":"ollama","model":"qwen2.5:7b","upstream_status":null,"timestamp":"2026-01-21T06:15:43.887536","suggestion":"Por favor, intenta de nuevo o verifica la configuración de providers.","metadata":{"error":"empty_response","original_result":"{'message': 'Lo siento, hubo un error al procesar tu mensaje. Por favor, inténtalo de nuevo.', 'error': 'Ollama no disponible', 'tokens_used': 0, 'cost': 0, 'provider': 'ollama', 'model': 'qwen2.5:7b'"}}```

**Resultado:** ❌ FAIL — provider=google terminó usando provider=ollama.

#### 6.2) Chat (openai) stream:false
```
HTTP/2 503 
date: Wed, 21 Jan 2026 06:15:44 GMT
content-type: application/json
content-length: 624
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=IYOZVate%2BjAWol1p%2BBml%2FoUwKWuM3FOwkd4vw8OJgEMkjAUntKx6JMjw0dOh1Ig8vJjDNxRIFqeX53eKW%2BXlbYPLdY310zcNc3RDdG6u7uzjsOEE0Q%3D%3D"}]}
cf-ray: 9c14adc45eaee8b5-MAD
alt-svc: h3=":443"; ma=86400

{"success":false,"error":"No se pudo generar una respuesta. El orchestrator devolvió una respuesta vacía o genérica.","error_code":"EMPTY_RESPONSE","trace_id":"0a2973de","provider":"ollama","model":"qwen2.5:7b","upstream_status":null,"timestamp":"2026-01-21T06:15:44.390173","suggestion":"Por favor, intenta de nuevo o verifica la configuración de providers.","metadata":{"error":"empty_response","original_result":"{'message': 'Lo siento, hubo un error al procesar tu mensaje. Por favor, inténtalo de nuevo.', 'error': 'Ollama no disponible', 'tokens_used': 0, 'cost': 0, 'provider': 'ollama', 'model': 'qwen2.5:7b'"}}```

**Resultado:** ❌ FAIL — provider=openai terminó usando provider=ollama.

#### 6.3) Chat (anthropic) stream:false
```
HTTP/2 503 
date: Wed, 21 Jan 2026 06:15:44 GMT
content-type: application/json
content-length: 624
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=2%2FvQNyXOwpBisfss0NKBEdUYzQUZsWiXapMEhsi4jLcz0fXU1NcuNRLuXDh%2FeVRzUy3i2HoZ4uxyLtgIxUe4tLFpTb5zFNqE8%2BSKmeV3SBnefRo%3D"}]}
cf-ray: 9c14adc77ee128ef-MAD
alt-svc: h3=":443"; ma=86400

{"success":false,"error":"No se pudo generar una respuesta. El orchestrator devolvió una respuesta vacía o genérica.","error_code":"EMPTY_RESPONSE","trace_id":"8bd41cb1","provider":"ollama","model":"qwen2.5:7b","upstream_status":null,"timestamp":"2026-01-21T06:15:44.888502","suggestion":"Por favor, intenta de nuevo o verifica la configuración de providers.","metadata":{"error":"empty_response","original_result":"{'message': 'Lo siento, hubo un error al procesar tu mensaje. Por favor, inténtalo de nuevo.', 'error': 'Ollama no disponible', 'tokens_used': 0, 'cost': 0, 'provider': 'ollama', 'model': 'qwen2.5:7b'"}}```

**Resultado:** ❌ FAIL — provider=anthropic terminó usando provider=ollama.

### 5) API chat alternativa (/api/chat) (solo para comparar contrato)
```
HTTP/2 200 
date: Wed, 21 Jan 2026 06:15:45 GMT
content-type: application/json
content-length: 308
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=hWdl5XmuR%2F76zK4Zpmxr3iaQVhvSzZ7I%2FWGpn0tyHLAH1MupuvkSKfcT9KlJd5%2FP8sKiwflJvcNp4hi%2BLMO8SpSjPlAz7u7sdIbidTEhPltpWGc%3D"}]}
cf-ray: 9c14adca9a2d7a1d-MAD
alt-svc: h3=":443"; ma=86400

{"response":"Lo siento, hubo un error al procesar tu mensaje. Por favor, inténtalo de nuevo.","session_id":"sess_cache_1768976145","requires_event_selection":false,"suggested_events":[],"metadata":{"provider":"cache","model":"cached_response","response_time_ms":1,"from_cache":true,"cache_type":"greeting"}}```

## Fin smoke test
- **RequestId**: `smoke_20260121_071541_20431`
- **Reporte**: `docs/reports/BACKEND_IA_SMOKE_smoke_20260121_071541_20431.md`
