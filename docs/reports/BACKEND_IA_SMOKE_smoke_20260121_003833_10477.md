## Smoke Test Backend IA

- **Base URL**: `https://api-ia.bodasdehoy.com`
- **Development**: `bodasdehoy`
- **Providers**: `auto`
- **Model (default)**: ``
- **RequestId**: `smoke_20260121_003833_10477`
- **Fecha (UTC)**: `2026-01-20T23:38:33Z`

### 1) Health
```
HTTP/2 200 
date: Tue, 20 Jan 2026 23:38:34 GMT
content-type: application/json
content-length: 124
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=t5eb%2Bn9NJLXS0tUE27brz78No%2FXTVRCgfLFyUoIpAOV7jCVYr3Y9MyKDOH%2BbDB%2BgdNo%2BK6OonGaT6tHA2voYw49X2gqIEujKdwpxp5dlX%2F3Vu7w%3D"}]}
cf-ray: 9c1267fabb871d02-MAD
alt-svc: h3=":443"; ma=86400

{"status":"healthy","timestamp":"2026-01-20T23:38:34.325218","services":{"websockets":"0 active","graphql_proxy":"running"}}```

### 2) Models (auto)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 23:38:34 GMT
content-type: application/json
content-length: 213
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=NS92ihon6cEkd719mmS5WPWASc%2BwhQIa0aGmtre6yDQV4JBi6lNzCcOVQJJrjksgUPz8t5MstkD9cd2F59uACCYDtIl%2F5UKr205BGGllW4gEykpa1w%3D%3D"}]}
cf-ray: 9c1267fd7cebcc53-MAD
alt-svc: h3=":443"; ma=86400

[{"id":"auto","name":"Auto - Selección automática","provider":"auto","context":128000,"maxOutput":4096,"description":"El sistema selecciona automáticamente el mejor provider según disponibilidad y criterios"}]```

### 3) Chat (auto) stream:false (esperado: JSON)
```
HTTP/2 503 
date: Tue, 20 Jan 2026 23:38:36 GMT
content-type: application/json
content-length: 625
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=Yt0mjAKub6S70VYhnAyyK%2Fn9Eim6h%2BHXLZvbVthNgT%2BGXkZPOnLkynJAfoFLM7L7UTZ84lT0oHVa1d8TQaNGxboNVsV%2FeZndus%2FDeEe%2Br77%2B67k%3D"}]}
cf-ray: 9c1267ff4a9202d4-MAD
alt-svc: h3=":443"; ma=86400

{"success":false,"error":"No se pudo generar una respuesta. El orchestrator devolvió una respuesta vacía o genérica.","error_code":"EMPTY_RESPONSE","trace_id":"3b85b90a","provider":"openai","model":"gpt-4o-mini","upstream_status":null,"timestamp":"2026-01-20T23:38:36.567404","suggestion":"Por favor, intenta de nuevo o verifica la configuración de providers.","metadata":{"error":"empty_response","original_result":"{'message': 'Lo siento, hubo un error al procesar tu mensaje. Por favor, inténtalo de nuevo.', 'error': 'Error de OpenAI: 429', 'tokens_used': 0, 'cost': 0, 'provider': 'openai', 'model': 'gpt-4o-mini"}}```

**Resultado:** ⚠️ WARN — 503 con error_code: EMPTY_RESPONSE pero el upstream parece ser 429 (rate limit).

**Sugerencia (backend):** devolver error_code=UPSTREAM_RATE_LIMIT (o similar) y upstream_status=429 explícito, en lugar de error_code=EMPTY_RESPONSE.

### 4) Chat (auto) stream:true (esperado: SSE sin event:error, o 503 JSON estructurado)
```
HTTP/2 503 
date: Tue, 20 Jan 2026 23:38:37 GMT
content-type: application/json
content-length: 508
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=wVaMApRRAmhJaj2xYd4U1KVC8TFcerOXe4Ul39jWn32%2FnqJwdgWBmj3dmYkyFJERBp1w996yZsSY%2FxhNClf0Z96R385mFTPxj1s5J4WCU1gZPrc%3D"}]}
cf-ray: 9c12680baaeac9ae-MAD
alt-svc: h3=":443"; ma=86400

{"detail":{"error":"No hay proveedores disponibles. Por favor, configura al menos una API key (OpenAI, Anthropic, OpenRouter, etc.) o asegúrate de que Ollama esté corriendo.","error_code":"NO_PROVIDERS_AVAILABLE","trace_id":"1571908a","provider":"auto","model":null,"upstream_status":null,"timestamp":"2026-01-20T23:38:37.273994","context":{"suggestion":"Por favor, configura al menos una API key (OPENAI_API_KEY, ANTHROPIC_API_KEY, OPENROUTER_API_KEY, etc.) o asegúrate de que Ollama esté corriendo."}}}```

**Resultado:** ✅ OK (503 esperado: NO_PROVIDERS_AVAILABLE).

### 5) API chat alternativa (/api/chat) (solo para comparar contrato)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 23:38:37 GMT
content-type: application/json
content-length: 308
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=Dzg1%2BeQRyBIWb%2BDex8aC%2FL8g%2BzIT9I5d2O05LSjPnRwORhCvvkvZ%2Bq6bN3MhGQA%2F9mAfjyRWM9zRH0rCJZ7hWQA5R7dUjuQJJriXMEVbAHz4ZTc%3D"}]}
cf-ray: 9c12680fffcef443-MAD
alt-svc: h3=":443"; ma=86400

{"response":"Lo siento, hubo un error al procesar tu mensaje. Por favor, inténtalo de nuevo.","session_id":"sess_cache_1768952318","requires_event_selection":false,"suggested_events":[],"metadata":{"provider":"cache","model":"cached_response","response_time_ms":1,"from_cache":true,"cache_type":"greeting"}}```

## Fin smoke test
- **RequestId**: `smoke_20260121_003833_10477`
- **Reporte**: `docs/reports/BACKEND_IA_SMOKE_smoke_20260121_003833_10477.md`
