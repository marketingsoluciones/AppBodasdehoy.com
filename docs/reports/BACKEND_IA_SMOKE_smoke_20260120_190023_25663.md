## Smoke Test Backend IA

- **Base URL**: `https://api-ia.bodasdehoy.com`
- **Development**: `bodasdehoy`
- **Providers**: `openrouter ollama`
- **Model (default)**: `openrouter/auto`
- **RequestId**: `smoke_20260120_190023_25663`
- **Fecha (UTC)**: `2026-01-20T18:00:23Z`

### 1) Health
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:23 GMT
content-type: application/json
content-length: 124
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=FMVbACrSFWRNyB6gsRdM0OrY8LcSrUmaL5%2BKyQrbIrDptytH9Rr37L0Ex7vebv3X2ercJAfDOHW7%2BTPQv8jzEt5mJEMvABkTDA9cYzpVeUtndIIeZA%3D%3D"}]}
cf-ray: 9c10789aabb44c8c-MAD
alt-svc: h3=":443"; ma=86400

{"status":"healthy","timestamp":"2026-01-20T18:00:23.785722","services":{"websockets":"0 active","graphql_proxy":"running"}}```

### 2) Models (openrouter)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:24 GMT
content-type: application/json
content-length: 740
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=cIDPiMpt1raENC7IJJKGV7U1lHwwcoKBUIQ3tPvOP50LqzQQrZm88rB6tN9FHw%2FTeWlzv1T4Tsy%2FptH4tUkZgMbaZqPU14xEyF2BmysxjgHgNo8%3D"}]}
cf-ray: 9c10789dab190361-MAD
alt-svc: h3=":443"; ma=86400

{"models":[{"id":"openrouter/auto","name":"Openrouter/Auto","provider":"openrouter","context":128000,"maxOutput":4096},{"id":"anthropic/claude-3.5-sonnet","name":"Claude 3.5 Sonnet","provider":"openrouter","context":128000,"maxOutput":4096},{"id":"openai/gpt-4o","name":"GPT-4","provider":"openrouter","context":128000,"maxOutput":4096},{"id":"google/gemini-pro-1.5","name":"Gemini 1.5 Pro","provider":"openrouter","context":128000,"maxOutput":4096},{"id":"qwen2.5:7b","name":"Qwen 2.5 7B","provider":"ollama","context":128000,"maxOutput":4096},{"id":"llama3.2:3b","name":"Llama 3.2 3B","provider":"ollama","context":128000,"maxOutput":4096},{"id":"phi3:medium","name":"Phi-3 Medium","provider":"ollama","context":128000,"maxOutput":4096}]}```

### 3) Chat (openrouter) stream:false (esperado: JSON)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:24 GMT
content-type: application/json
content-length: 109
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=G0Pn3s6zSpo44fUABk6JgwA7INyFDo%2FYdPrn95hwjsv4tzHZJSGKj%2FvyMSsFr%2B%2BOac9pNIIj7jnWb%2BD%2FG%2B16%2F4o3C1d4xWSwOtdxMjzlQ7lsjvI%3D"}]}
cf-ray: 9c10789f6ed8ec99-MAD
alt-svc: h3=":443"; ma=86400

{"success":true,"message":"","metadata":{},"provider":"ollama","model":"qwen2.5:7b","tokens_used":0,"cost":0}```

### 4) Chat (openrouter) stream:true (esperado: SSE sin event:error)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:24 GMT
content-type: text/event-stream; charset=utf-8
cache-control: no-cache
server: cloudflare
x-model: openrouter/auto
x-provider: openrouter
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=EU1Cbb13cDq2evTMgY9YJg3F6JOCW%2BWca5KE3pwuLvg8qsMFVcS3Ym%2FXMTNulrF64K46fVyfcfqNxCfrRvqxJOrHg1xN8CObcnp%2Be4wYN2K87Nc9jQ%3D%3D"}]}
cf-ray: 9c1078a29df50142-MAD
alt-svc: h3=":443"; ma=86400

event: error
data: {"error": "API key de OpenRouter no configurada y no hay fallback disponible. Por favor, configura OPENROUTER_API_KEY o usa otro provider.", "error_code": "AUTH_ERROR", "trace_id": "bb54cf2e", "provider": "openrouter", "model": "openrouter/auto", "upstream_status": null, "timestamp": "2026-01-20T18:00:24.873397", "context": {}}

event: done
data: {}

```

### 2) Models (ollama)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:25 GMT
content-type: application/json
content-length: 587
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=AEIT%2FDGHNE4pX5pcLEjziKT80Av7YsU8JLeEnk4y6CfRMRk7EXfJ3fxQhl8OZQhfQCDHITix6%2FbQhRIC3Bj0Vj4M5iIhQAdDGK6nSk32m13ygkGyvg%3D%3D"}]}
cf-ray: 9c1078a48b79cbde-MAD
alt-svc: h3=":443"; ma=86400

{"models":[{"id":"qwen2.5:7b","name":"Qwen2.5:7B","provider":"ollama","context":128000,"maxOutput":4096},{"id":"llama3.2:3b","name":"Llama3.2:3B","provider":"ollama","context":128000,"maxOutput":4096},{"id":"phi3:medium","name":"Phi3:Medium","provider":"ollama","context":128000,"maxOutput":4096},{"id":"qwen2.5:7b","name":"Qwen 2.5 7B","provider":"ollama","context":128000,"maxOutput":4096},{"id":"llama3.2:3b","name":"Llama 3.2 3B","provider":"ollama","context":128000,"maxOutput":4096},{"id":"phi3:medium","name":"Phi-3 Medium","provider":"ollama","context":128000,"maxOutput":4096}]}```

### 3) Chat (ollama) stream:false (esperado: JSON)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:25 GMT
content-type: application/json
content-length: 109
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=Ql82N2QyZCrA1vJo6%2B%2BzVOdVROgpfaw4uzA5%2FS%2BiSAsa5thFUk7oTqEwu6a2mnAy5wTSGRRj52f6MgqYv8ePIx%2FKy5zPDjQy9SRCg04LAGkSnoUolw%3D%3D"}]}
cf-ray: 9c1078a66cd10366-MAD
alt-svc: h3=":443"; ma=86400

{"success":true,"message":"","metadata":{},"provider":"ollama","model":"qwen2.5:7b","tokens_used":0,"cost":0}```

### 4) Chat (ollama) stream:true (esperado: SSE sin event:error)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:26 GMT
content-type: text/event-stream; charset=utf-8
cache-control: no-cache
server: cloudflare
x-model: openrouter/auto
x-provider: ollama
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=SguBMpvf7YN6N0qp2NYQ61Fmgt%2Br7CmT4nhg8pxNyWYebwewkMnwoX9ZJ8mDM7vOv%2B%2FNamwu3Cqsn9dyKlNG%2FPXkWQs9LFBkpwWLoKjGNPRYoow%3D"}]}
cf-ray: 9c1078aabbde028a-MAD
alt-svc: h3=":443"; ma=86400

event: error
data: {"error": "\u26a0\ufe0f Orchestrator fall\u00f3: Ollama no disponible"}

event: done
data: {}

```

### 5) API chat alternativa (/api/chat) (solo para comparar contrato)
```
HTTP/2 200 
date: Tue, 20 Jan 2026 18:00:26 GMT
content-type: application/json
content-length: 308
server: cloudflare
cf-cache-status: DYNAMIC
nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}
report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=oLaaYNNTw7whg73OjvfU4M6IVjhsqqoR3pfqoVGAVrCDaMc1kdIG%2FeVSwNv5M%2F%2B%2FhpcYJHKe6Ocge6tutZVVQNZAajKeI2489TzTRx2pKGJ2kvM%3D"}]}
cf-ray: 9c1078ae1d190270-MAD
alt-svc: h3=":443"; ma=86400

{"response":"Lo siento, hubo un error al procesar tu mensaje. Por favor, int√©ntalo de nuevo.","session_id":"sess_cache_1768932027","requires_event_selection":false,"suggested_events":[],"metadata":{"provider":"cache","model":"cached_response","response_time_ms":1,"from_cache":true,"cache_type":"greeting"}}```

## Fin smoke test
- **RequestId**: `smoke_20260120_190023_25663`
- **Reporte**: `docs/reports/BACKEND_IA_SMOKE_smoke_20260120_190023_25663.md`
